<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#ff6b9d">
  <title>Thinky - Your Learning Companion</title>

  <link rel="shortcut icon" href="./images/logo.png" type="image/x-icon">
  <link rel="manifest" href="/manifest.json">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/anonymous-messages.css">
  <link rel="stylesheet" href="/css/admin-messages.css">
  <link rel="stylesheet" href="/css/device-messaging.css">
  <link rel="stylesheet" href="/css/notifications.css">
  <link rel="stylesheet" href="/css/message-notifications.css">
  <link rel="stylesheet" href="/css/anti-cheat-notifications.css">
  <link rel="stylesheet" href="/css/install-prompt.css">
  <link rel="stylesheet" href="/css/support-notifications.css">
  <link rel="stylesheet" href="/css/floating-message-button.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container">
      <a class="navbar-brand" href="/index.html">
        <i class="bi bi-lightbulb-fill"></i> Thinky
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto" id="navbarMenu">
          <li class="nav-item">
            <a class="nav-link active" href="/index.html">Home</a>
          </li>
          <!-- User menu will be inserted here by JavaScript -->
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="hero">
    <div class="container">
      <h1>Welcome to Thinky</h1>
      <p>Learn. Review. Quiz. Your all-in-one study companion!</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="container">
      <div class="row mb-4">
        <div class="col-12">
          <h2 class="text-pink fw-bold">
            <i class="bi bi-collection-fill"></i> Courses
          </h2>
        </div>
      </div>

      <!-- Search -->
      <div class="row mb-4">
        <div class="col-12 col-md-8">
          <div class="input-group ">
            <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
            <input id="courseSearch" type="search" class="form-control" placeholder="Search courses..." aria-label="Search courses">
            <button id="clearSearch" class="btn btn-outline-pink" type="button" title="Clear search" style="display:none;"><i class="bi bi-x-lg"></i></button>
          </div>
        </div>
      </div>

      <!-- Courses Grid -->
      <div class="row" id="coursesContainer">
        <!-- Loading spinner -->
        <div class="col-12 text-center py-5" id="loadingSpinner">
          <div class="spinner-border spinner-pink" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading courses...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container d-flex justify-content-between align-items-center">
      <p class="mb-0">Made with <i class="bi bi-heart-fill text-pink"></i> by <strong>Chael</strong></p>
      <div>
        <a href="https://www.facebook.com/profile.php?id=61579285053347" target="_blank" class="me-2 text-pink" aria-label="Chael on Facebook"><i class="bi bi-facebook"></i></a>
        <a href="https://www.instagram.com/keliiiiiiii_/" target="_blank" class="text-pink" aria-label="Chael on Instagram"><i class="bi bi-instagram"></i></a>
      </div>
    </div>
  </footer>

  <!-- Message Notification Container -->
  <div class="message-notification-container" id="messageNotificationContainer"></div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- DOMPurify for XSS Protection -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Security Utilities -->
  <script src="/js/security-utils.js"></script>  <!-- Dark Mode -->
  <script src="/js/dark-mode.js"></script>
  
  <!-- Anti-Cheat Notifications -->
  <script src="/js/anti-cheat-notifications.js"></script>
  
  <!-- Install Prompt -->
  <script src="/js/install-prompt.js"></script>
  
  <!-- Supabase Config -->
  <script src="/js/supabase-config.js"></script>
  
  <!-- Page Script -->
  <script src="/js/index.js"></script>
  
  <!-- Login Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header" style="background: linear-gradient(135deg, #E91E63 0%, #F06292 100%); color: white; border: none;">
          <h5 class="modal-title" id="loginModalLabel">
            <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <form id="loginForm">
            <div class="mb-3">
              <label for="loginEmail" class="form-label">Email address</label>
              <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required>
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                <button class="btn btn-outline-secondary" type="button" id="toggleLoginPassword">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
            </div>
            <div class="mb-3 text-end">
              <a href="forgot-password.html" class="text-decoration-none" style="color: #E91E63;">Forgot Password?</a>
            </div>
            <button type="submit" class="btn w-100" style="background: #E91E63; color: white; padding: 12px; font-weight: 600;" id="loginBtn">
              <span id="loginBtnText">Sign In</span>
              <span id="loginSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
            </button>
            <div class="text-center mt-3">
              <span class="text-muted">Don't have an account?</span>
              <a href="#" class="text-decoration-none" style="color: #E91E63;" data-bs-toggle="modal" data-bs-target="#signupModal" data-bs-dismiss="modal">Create Account</a>
            </div>
          </form>
          <div class="alert alert-danger mt-3 d-none" id="loginErrorAlert"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Signup Modal -->
  <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header" style="background: linear-gradient(135deg, #E91E63 0%, #F06292 100%); color: white; border: none;">
          <h5 class="modal-title" id="signupModalLabel">
            <i class="bi bi-person-plus me-2"></i>Create Account
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <!-- Step 1: Signup Form -->
          <div id="signupStep">
            <form id="signupForm">
              <div class="mb-3">
                <label for="displayName" class="form-label">Display Name</label>
                <input type="text" class="form-control" id="displayName" placeholder="Your name" required>
              </div>
              <div class="mb-3">
                <label for="signupEmail" class="form-label">Gmail Address</label>
                <input type="email" class="form-control" id="signupEmail" placeholder="yourname@gmail.com" required>
                <small class="text-muted">We'll send a verification code to this email</small>
              </div>
              <div class="mb-3">
                <label for="signupPassword" class="form-label">Password</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="signupPassword" placeholder="Create a password" required>
                  <button class="btn btn-outline-secondary" type="button" id="toggleSignupPassword">
                    <i class="bi bi-eye"></i>
                  </button>
                </div>
                <ul class="password-requirements mt-2" style="font-size: 0.875rem; color: #666; list-style: none; padding-left: 0;">
                  <li id="lengthReq"><i class="bi bi-circle"></i> At least 8 characters</li>
                  <li id="uppercaseReq"><i class="bi bi-circle"></i> One uppercase letter</li>
                  <li id="lowercaseReq"><i class="bi bi-circle"></i> One lowercase letter</li>
                  <li id="numberReq"><i class="bi bi-circle"></i> One number</li>
                </ul>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your password" required>
              </div>
              <button type="submit" class="btn w-100" style="background: #E91E63; color: white; padding: 12px; font-weight: 600;" id="signupBtn">
                <span id="signupBtnText">Create Account</span>
                <span id="signupSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
              </button>
              <div class="text-center mt-3">
                <span class="text-muted">Already have an account?</span>
                <a href="#" class="text-decoration-none" style="color: #E91E63;" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Sign In</a>
              </div>
            </form>
          </div>

          <!-- Step 2: Verification -->
          <div id="verificationStep" class="d-none">
            <div class="text-center mb-4">
              <i class="bi bi-envelope-check-fill" style="font-size: 3rem; color: #E91E63;"></i>
              <h5 class="mt-3">Verify Your Email</h5>
              <p class="text-muted">We sent a 6-digit code to<br><strong id="verificationEmail"></strong></p>
            </div>
            <form id="verificationForm">
              <div class="d-flex gap-2 justify-content-center mb-3">
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="0" required>
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="1" required>
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="2" required>
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="3" required>
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="4" required>
                <input type="text" maxlength="1" class="form-control code-input text-center" style="width: 50px; height: 50px; font-size: 24px; font-weight: bold;" data-index="5" required>
              </div>
              <button type="submit" class="btn w-100" style="background: #E91E63; color: white; padding: 12px; font-weight: 600;" id="verifyBtn">
                <span id="verifyBtnText">Verify Email</span>
                <span id="verifySpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
              </button>
              <div class="text-center mt-3">
                <button type="button" class="btn btn-link text-decoration-none" id="resendBtn" style="color: #E91E63;">
                  Resend Code
                </button>
              </div>
            </form>
          </div>

          <div class="alert alert-danger mt-3 d-none" id="signupErrorAlert"></div>
          <div class="alert alert-success mt-3 d-none" id="signupSuccessAlert"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Required Modal -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header" style="background: linear-gradient(135deg, #E91E63 0%, #F06292 100%); color: white; border: none;">
          <h5 class="modal-title" id="authModalLabel">
            <i class="bi bi-lock-fill me-2"></i>Authentication Required
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center py-4">
          <i class="bi bi-shield-lock" style="font-size: 4rem; color: #E91E63;"></i>
          <h4 class="mt-3 mb-3">Sign in to continue</h4>
          <p class="text-muted">You need to create an account or sign in to access courses, subjects, and reviewers.</p>
          <div class="d-grid gap-2 mt-4">
            <button class="btn btn-primary btn-lg" style="background: #E91E63; border: none;" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">
              <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
            </button>
            <button class="btn btn-outline-primary btn-lg" style="border-color: #E91E63; color: #E91E63;" data-bs-toggle="modal" data-bs-target="#signupModal" data-bs-dismiss="modal">
              <i class="bi bi-person-plus me-2"></i>Create Account
            </button>
          </div>
          <p class="text-muted mt-3 mb-0"><small>Join our community to access all features!</small></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Check -->
  <script>
    // Check auth status and update navbar, but don't redirect
    (async function() {
      const user = await getCurrentUser();
      if (user) {
        const profile = await getCurrentUserProfile();
        if (profile && profile.email_verified) {
          // User is authenticated and verified
          initializeUserNav();
        }
      }
      
      // Check if redirected from protected page
      if (sessionStorage.getItem('authRequired') === 'true') {
        sessionStorage.removeItem('authRequired');
        // Show auth modal
        setTimeout(() => {
          const authModal = new bootstrap.Modal(document.getElementById('authModal'));
          authModal.show();
        }, 500);
      }
    })();
  </script>
  
  <!-- Auth Modals Script -->
  <script src="/js/auth-modals.js"></script>
  
  <!-- Anonymous Messages -->
  <script src="/js/anonymous-messages.js"></script>
  
  <!-- Device Messaging -->
  <script src="/js/device-messaging.js"></script>
  
  <!-- Message Notifications -->
  <script src="/js/message-notifications.js"></script>
  
  <!-- Notifications -->
  <script src="/js/notifications.js"></script>
  
  <!-- Support Notifications -->
  <script src="/js/support-notifications.js"></script>
</body>
</html>
